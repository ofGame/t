<!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>双爆配平器</title> <script src="https://cdn.tailwindcss.com"></script> <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script> <script>tailwind.config={darkMode:"class",theme:{extend:{animation:{rise:"rise 0.5s ease-out forwards"},keyframes:{rise:{"0%":{opacity:"0",transform:"translateY(.5rem)"},"100%":{opacity:"1",transform:"translateY(0)"}}}}}}</script> <style type="text/tailwindcss">@layer utilities { .bg-base { @apply bg-gray-100 dark:bg-gray-800/80 dark:text-white; } .bg-acid { @apply bg-white dark:bg-gray-800/80 } .input-focus { @apply focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all duration-300; } .btn { @apply rounded-lg hover:scale-105 transform transition-all duration-300; } .btn-bold { @apply btn font-bold py-2 px-6 text-white hover:opacity-80; } .base-item { @apply rounded-lg border border-2 mb-2 transition-all duration-300; } .scrollbar-hide { scrollbar-width: none; -ms-overflow-style: none; &::-webkit-scrollbar { display: none; } } } @layer components { .card { @apply bg-acid rounded-xl p-6 mb-8 shadow-md hover:shadow-lg } .section-header { @apply text-xl font-semibold mb-4 } .form-control { @apply bg-base rounded-lg text-sm border border-gray-300 } .form-label { @apply block text-sm text-gray-500 mb-1 } .form-input { @apply form-control w-full input-focus appearance-none py-2 px-4 } .btn-gray-800 { @apply btn form-control font-medium py-1 px-2 text-gray-400 float-right hover:text-white hover:bg-gray-800/80 } .btn-sky-500 { @apply btn-bold bg-sky-500 } .btn-emerald-500 { @apply btn-bold bg-emerald-500 } .btn-violet-500 { @apply btn-bold bg-violet-500 } .history-item { @apply bg-acid base-item p-2 border-gray-200 dark:border-gray-700 cursor-grab select-none; } .history-placeholder { @apply base-item border-dashed border-sky-500 bg-sky-500/10; } .modal-backdrop { @apply fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4; } .modal-content { @apply bg-acid rounded-xl p-6 w-full max-w-md shadow-2xl; } .form-checkbox { @apply h-4 w-4 mr-2 } }</style> </head> <body> <div id="app" class="bg-base"> <div class="container mx-auto py-6 px-4 max-w-5xl"> <div class="flex flex-col justify-center lg:flex-row gap-6"> <main class="lg:w-3/5"> <section class="card"> <div class="mb-2"> <h2 class="section-header">基础属性输入 <button id="themeToggle" class="btn-gray-800">主题</button> </h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"> <div> <div class="mb-4"> <label for="EntryW" class="form-label">角色基础攻击（白值）</label> <input type="number" id="EntryW" class="form-input" placeholder="请输入角色基础攻击"> </div> <div class="mb-4"> <label for="EntryG" class="form-label">角色攻击提升值（绿值）</label> <input type="number" id="EntryG" class="form-input" placeholder="请输入角色攻击提升值"> </div> <div class="mb-4"> <label for="ClaimA" class="form-label">伤害模型转换</label> <select id="ClaimA" class="form-input"> <option value="1">攻击</option> <option value="1">生命</option> <option value="1.25">防御</option> <option value="400" disabled="disabled">精通</option> </select> </div> </div> <div> <div class="mb-4"> <label for="EntryB" class="form-label">暴击率 %</label> <input type="number" id="EntryB" class="form-input" placeholder="请输入暴击率"> </div> <div class="mb-4"> <label for="EntryC" class="form-label">暴击伤害 %</label> <input type="number" id="EntryC" class="form-input" placeholder="请输入暴击伤害"> </div> <div class="mb-4"> <p class="form-label">测试</p> <div class="flex justify-between"> <button id="randomBtn" class="btn-emerald-500">随机生成</button> <button id="clearBtn" class="btn-violet-500">清空输入</button> </div> </div> </div> </div> </div> <button id="calculateBtn" class="btn-sky-500 w-full">计算属性分配</button> </section> <section class="card"> <div id="resultsContainer" class="mb-8"> <h2 class="section-header">计算结果 <button id="saveBtn" class="btn-gray-800" disabled="disabled">保存</button> </h2> <div class="bg-base form-control p-6"> <ul id="ResultsList" class="space-y-3 transition will-change-transform"></ul> </div> </div> <h2 class="section-header">乘区计算</h2> <a href="https://homdgcat.wiki/gi/formulae" class="font-bold text-sky-500 hover:text-violet-500">玉衡杯-公式大全</a> </section> </main> <aside class="lg:w-2/5" id="aside"> <section class="card sticky top-4"> <h2 class="section-header">保存记录 <button id="removeBtn" class="btn-gray-800">移除</button> </h2> <div class="mb-3 space-y-3"> <div> <label for="historySearch" class="form-label">搜索记录</label> <input type="text" id="historySearch" class="form-input" placeholder="输入名称搜索..."> </div> <div class="flex items-center justify-between m-2"> <label class="flex items-center text-sm"> <input type="checkbox" id="selectAll" class="form-checkbox"> 全选 </label> <div class="flex gap-4"> <button id="reverseHistoryBtn" class="text-sky-500 hover:opacity-80 text-sm"> 反转顺序 </button> <button id="deleteSelectedBtn" class="text-red-500 hover:opacity-80 text-sm" disabled="disabled"> 删除所选 </button> </div> </div> </div> <div id="historyList" class="max-h-[62vh] overflow-y-auto scrollbar-hide"> <p class="text-gray-500 text-sm p-2">暂无记录</p> </div> </section> </aside> </div> <footer class="text-center mt-8 text-gray-400 text-sm"> <p>contact©原神UID 226115372</p> </footer> </div> <div id="saveModal" class="modal-backdrop hidden"> <div class="modal-content"> <h3 class="section-header">保存计算结果</h3> <div class="mb-8"> <label for="saveName" class="form-label">请输入结果名称</label> <input type="text" id="saveName" class="form-input" placeholder="例如：爆伤头2+2"> </div> <div class="flex justify-between"> <button id="cancelSaveBtn" class="btn btn-violet-500">取消保存</button> <button id="confirmSaveBtn" class="btn btn-sky-500">确认保存</button> </div> </div> </div> </div> <script>const btn=document.getElementById("removeBtn");function handleClick(){const e=document.getElementById("aside");e&&e.remove()}function formatTime(e){return`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`}btn.addEventListener("click",handleClick,{once:!0});const AppConfig={inputFields:[{id:"EntryW",base:500,labelKey:"基础"},{id:"EntryG",base:1e3,labelKey:"提升值"},{id:"EntryB",base:50},{id:"EntryC",base:100}],constants:{CLAIM_B:.038875,CLAIM_C:.07775,CLAIM_A:.0583125}},elements=(()=>{const e={list:document.getElementById("ResultsList"),claimA:document.getElementById("ClaimA"),randomBtn:document.getElementById("randomBtn"),clearBtn:document.getElementById("clearBtn"),calculateBtn:document.getElementById("calculateBtn"),saveBtn:document.getElementById("saveBtn"),themeToggle:document.getElementById("themeToggle"),body:document.body,historyList:document.getElementById("historyList"),historySearch:document.getElementById("historySearch"),selectAll:document.getElementById("selectAll"),deleteSelectedBtn:document.getElementById("deleteSelectedBtn"),reverseHistoryBtn:document.getElementById("reverseHistoryBtn"),saveModal:document.getElementById("saveModal"),saveName:document.getElementById("saveName"),cancelSaveBtn:document.getElementById("cancelSaveBtn"),confirmSaveBtn:document.getElementById("confirmSaveBtn")};return AppConfig.inputFields.reduce((e,t)=>(e[t.id]=document.getElementById(t.id),t.labelKey&&(e[`label${t.id}`]=document.querySelector(`label[for="${t.id}"]`)),e),e)})(),AppState={currentCalculation:null,sortable:null,currentSearchTerm:""},HistoryManager={getHistory(){try{const e=localStorage.getItem("calculationHistory");if(e){const t=JSON.parse(e);return Array.isArray(t)?t:[]}}catch(e){console.error("获取记录失败:",e),localStorage.removeItem("calculationHistory")}return[]},saveHistory(e,t){if(!e)return!1;try{const n=this.getHistory(),a={...e,timestamp:(new Date).toISOString(),name:t||`计算记录-${formatTime(new Date)}`};return n.unshift(a),localStorage.setItem("calculationHistory",JSON.stringify(n)),this.renderHistory(),!0}catch(e){return console.error("保存记录失败:",e),alert("保存失败，请重试"),!1}},reorderHistory(e){try{if(Array.isArray(e))return localStorage.setItem("calculationHistory",JSON.stringify(e)),!0}catch(e){console.error("重新排序记录失败:",e)}return!1},reverseHistory(){try{let e=this.getHistory();return!(e.length<=1)&&(e.reverse(),this.reorderHistory(e),this.renderHistory(),!0)}catch(e){console.error("反转记录失败:",e)}return!1},deleteHistory(e){try{const t=this.getHistory();if(Number.isInteger(e)&&e>=0&&e<t.length)return t.splice(e,1),localStorage.setItem("calculationHistory",JSON.stringify(t)),this.renderHistory(),!0}catch(e){console.error("删除记录失败:",e)}return!1},deleteSelected(){const e=document.querySelectorAll(".history-checkbox:checked");if(0===e.length)return!1;try{let t=this.getHistory();return Array.from(e).map(e=>parseInt(e.dataset.index,10)).filter(e=>!isNaN(e)).sort((e,t)=>t-e).forEach(e=>{t.splice(e,1)}),localStorage.setItem("calculationHistory",JSON.stringify(t)),this.renderHistory(),!0}catch(e){console.error("删除选中记录失败:",e)}return!1},updateSelectAllStatus(){const e=document.querySelectorAll(".history-checkbox"),t=document.querySelectorAll(".history-checkbox:checked"),n=e.length>0;elements.selectAll.checked=n&&e.length===t.length,elements.deleteSelectedBtn.disabled=0===t.length},filterHistory(e,t){if(!t)return e;const n=t.toLowerCase();return e.filter(e=>e.name?.toLowerCase().includes(n)||e.stats?.综合评分?.includes(n)||e.stats?.评价?.toLowerCase().includes(n))},renderHistory(){try{const e=this.getHistory(),t=this.filterHistory(e,AppState.currentSearchTerm),n=elements.historyList;if(0===t.length)return n.innerHTML=`<p class="text-gray-500 text-sm p-2">${AppState.currentSearchTerm?"没有匹配的":"暂无"}记录</p>`,this.destroySortable(),void this.updateSelectAllStatus();n.innerHTML="";const a=document.createElement("div");a.id="sortable-history",n.appendChild(a),t.forEach(t=>{const n=e.findIndex(e=>e.timestamp===t.timestamp);if(-1===n)return;const s=formatTime(new Date(t.timestamp)),l=document.createElement("div");l.className="history-item",l.dataset.index=n,l.innerHTML=`<label class="flex items-center"><input type="checkbox" class="history-checkbox form-checkbox" data-index="${n}"><span class="font-medium text-sm">${t.name}</span></label><div class="flex justify-between"><div class="text-xs ml-6"><div class="text-gray-500 mt-1">${s}</div><p><span class="${t.stats?.评价Class}">${t.stats?.评价}</span> 综合评分: ${t.stats?.综合评分}</p><p>${t.params?.selectedText}总值: ${t.stats?.总值}</p><p>暴击爆伤: ${t.stats?.暴击率}/${t.stats?.暴击伤害}</p></div><button class="delete-item text-red-500 hover:opacity-80 text-xs" data-index="${n}">删除</button></div>`,a.appendChild(l),l.querySelector(".delete-item").addEventListener("click",e=>{e.stopPropagation(),this.deleteHistory(n)}),l.querySelector(".history-checkbox").addEventListener("change",()=>{this.updateSelectAllStatus()}),l.addEventListener("click",e=>{e.target.closest(".delete-item")||e.target.closest(".history-checkbox")||this.loadHistoryItem(t)})}),this.initSortable(a),this.updateSelectAllStatus()}catch(e){console.error("渲染记录失败:",e),container.innerHTML='<p class="text-red-500 text-sm">加载记录失败</p>'}},initSortable(e){this.destroySortable(),AppState.currentSearchTerm||(AppState.sortable=new Sortable(e,{animation:150,ghostClass:"history-placeholder",chosenClass:"history-item-dragging",dragClass:"history-item-dragging",onEnd:e=>{const t=this.getHistory(),[n]=t.splice(e.oldIndex,1);t.splice(e.newIndex,0,n),this.reorderHistory(t),this.renderHistory()}}))},destroySortable(){AppState.sortable&&(AppState.sortable.destroy(),AppState.sortable=null)},loadHistoryItem(e){if(e?.params&&(Object.entries(e.params).forEach(([e,t])=>{elements[e]&&"number"===elements[e].type&&(elements[e].value=t)}),e.stats)){updateResultsList([{label:"综合评分:",value:e.stats.综合评分},{label:`${e.params.selectedText}加成:`,value:e.stats.加成},{label:`总${e.params.selectedText}:`,value:e.stats.总值},{label:"暴击率:",value:e.stats.暴击率},{label:"暴击伤害:",value:e.stats.暴击伤害},{label:"总期望:",value:e.stats.总期望},{label:"评价:",value:e.stats.评价,customClass:e.stats.评价Class}]),AppState.currentCalculation=e,elements.saveBtn.disabled=!1}}},calculatePercentage=e=>(100*e).toFixed(1);function handleAnimationEnd(){elements.list.classList.remove("animate-rise"),elements.list.removeEventListener("animationend",handleAnimationEnd)}function updateResultsList(e){if(!e||!Array.isArray(e))return;elements.list.innerHTML="";const t=document.createDocumentFragment();e.forEach(e=>{const n=document.createElement("li");n.className=`flex ${e.customClass||""}`;const a=document.createElement("span");a.className="w-1/3",a.textContent=e.label;const s=document.createElement("span");s.className="flex-1",s.textContent=e.value,n.append(a,s),t.appendChild(n)}),elements.list.appendChild(t),elements.list.classList.remove("animate-rise"),requestAnimationFrame(()=>{elements.list.addEventListener("animationend",handleAnimationEnd),elements.list.classList.add("animate-rise")})}function getInputValues(){return AppConfig.inputFields.reduce((e,t)=>{const n=parseFloat(elements[t.id].value)||0;return e[t.id]=Math.max(0,n),e},{})}function calculateStats(){const{EntryW:e,EntryG:t,EntryB:n,EntryC:a}=getInputValues(),s=parseFloat(elements.claimA.value)||1,l=s*AppConfig.constants.CLAIM_A,r=elements.claimA.options[elements.claimA.selectedIndex].text,o=t/e/l,i=n/AppConfig.constants.CLAIM_B/100+a/AppConfig.constants.CLAIM_C/100+o,c=Math.sqrt(6)/AppConfig.constants.CLAIM_B-1/l;let d,m,u,p;if(i>7/AppConfig.constants.CLAIM_C-1/l)d=2/AppConfig.constants.CLAIM_C,m=(i+1/l-3/AppConfig.constants.CLAIM_C)/2,u=(i-1/l-1/AppConfig.constants.CLAIM_C)/2,p={text:"大毕业",class:"text-green-600 font-bold"};else if(i>c){const e=i+1/l;d=(e+Math.sqrt(Math.pow(e,2)-6/Math.pow(AppConfig.constants.CLAIM_B,2)))/6,m=d,u=i-2*d,p={text:"小毕业",class:"text-yellow-600 font-bold"}}else d=.05/AppConfig.constants.CLAIM_B,m=.5/AppConfig.constants.CLAIM_C,u=i-d-m,p={text:"未毕业",class:"text-red-600 font-bold"};const y=l*u,h=AppConfig.constants.CLAIM_B*d,g=AppConfig.constants.CLAIM_C*m,v=Math.round((y+1)*e),S=(v*(1+h*g)).toFixed(2);updateResultsList([{label:"综合评分:",value:i.toFixed(2)},{label:`${r}加成:`,value:`${calculatePercentage(y)}%`},{label:`总${r}:`,value:v},{label:"暴击率:",value:`${calculatePercentage(h)}%`},{label:"暴击伤害:",value:`${calculatePercentage(g)}%`},{label:"总期望:",value:S},{label:"评价:",value:p.text,customClass:p.class}]),AppState.currentCalculation={params:{EntryW:e,EntryG:t,EntryB:n,EntryC:a,ClaimA:s,selectedText:r},stats:{"综合评分":i.toFixed(2),"加成":`${calculatePercentage(y)}%`,"总值":v,"暴击率":`${calculatePercentage(h)}%`,"暴击伤害":`${calculatePercentage(g)}%`,"总期望":S,"评价":p.text,"评价Class":p.class}},elements.saveBtn.disabled=!1}function generateRandomNumbers(){AppConfig.inputFields.forEach(e=>{elements[e.id].value=Math.ceil((Math.random()+1)*e.base)}),calculateStats()}function clearInputValues(){AppConfig.inputFields.forEach(e=>{const t=elements[e.id];t&&(t.value="")}),elements.list.innerHTML="",elements.saveBtn.disabled=!0,AppState.currentCalculation=null,window.scrollTo({top:0,behavior:"smooth"})}function showSaveModal(){if(!AppState.currentCalculation)return void alert("没有可保存的计算结果");const e=`${elements.claimA.options[elements.claimA.selectedIndex].text}${AppState.currentCalculation.stats.评价} ${formatTime(new Date)}`;elements.saveName.value=e,elements.saveModal.classList.remove("hidden"),elements.saveName.focus()}function hideSaveModal(){elements.saveModal.classList.add("hidden"),elements.saveName.value=""}function saveCurrentResult(){if(!AppState.currentCalculation)return;const e=elements.saveName.value.trim();if(!e)return alert("请输入结果名称"),void elements.saveName.focus();HistoryManager.saveHistory(AppState.currentCalculation,e)&&hideSaveModal()}function initEventListeners(){const e=localStorage.getItem("theme");("dark"===e||!e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&elements.body.classList.add("dark"),HistoryManager.renderHistory(),elements.themeToggle.addEventListener("click",()=>{elements.body.classList.toggle("dark"),localStorage.setItem("theme",elements.body.classList.contains("dark")?"dark":"light")}),elements.randomBtn.addEventListener("click",generateRandomNumbers),elements.clearBtn.addEventListener("click",clearInputValues),elements.calculateBtn.addEventListener("click",()=>{calculateStats(),window.scrollTo({top:window.innerHeight,behavior:"smooth"})}),elements.saveBtn.addEventListener("click",showSaveModal),elements.historySearch.addEventListener("input",e=>{AppState.currentSearchTerm=e.target.value.trim(),HistoryManager.renderHistory()}),elements.reverseHistoryBtn.addEventListener("click",()=>{HistoryManager.reverseHistory()}),elements.selectAll.addEventListener("change",e=>{document.querySelectorAll(".history-checkbox").forEach(t=>{t.checked=e.target.checked}),HistoryManager.updateSelectAllStatus()}),elements.deleteSelectedBtn.addEventListener("click",()=>{confirm("确定要删除选中的记录吗？")&&HistoryManager.deleteSelected()}),elements.cancelSaveBtn.addEventListener("click",hideSaveModal),elements.confirmSaveBtn.addEventListener("click",saveCurrentResult),elements.saveModal.addEventListener("click",e=>{e.target===elements.saveModal&&hideSaveModal()}),document.addEventListener("keydown",e=>{"Escape"!==e.key||elements.saveModal.classList.contains("hidden")||hideSaveModal()}),elements.saveName.addEventListener("keydown",e=>{"Enter"===e.key&&saveCurrentResult()}),elements.claimA.addEventListener("change",function(){const e=this.options[this.selectedIndex].text;AppConfig.inputFields.filter(e=>e.labelKey).forEach(t=>{const n=elements[`label${t.id}`];n&&(n.textContent=`角色${t.labelKey}${e}（${"EntryW"===t.id?"白":"绿"}值）`);const a=elements[t.id];a&&(a.placeholder=`请输入角色${t.labelKey}${e}`)})}),elements.claimA.dispatchEvent(new Event("change"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initEventListeners):initEventListeners()</script> </body> </html>